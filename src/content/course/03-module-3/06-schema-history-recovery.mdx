---
title: "Schema History Topic: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ö–æ–º–ø–æ–Ω–µ–Ω—Ç Recovery"
description: "–ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ schema history topic MySQL CDC: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, retention requirements, recovery scenarios –∏ best practices"
order: 6
difficulty: "advanced"
estimatedTime: 30
topics: ["mysql", "debezium", "schema-history", "recovery", "kafka"]
prerequisites: ["module-8/05-binlog-wal-comparison"]
---

import { SchemaHistoryFlowDiagram, SchemaRecoveryPathsDiagram, SchemaHistoryCorruptionDiagram } from '../../../components/diagrams/module3/SchemaHistoryDiagrams';
import Callout from '../../../components/Callout.tsx';

# Schema History Topic: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ö–æ–º–ø–æ–Ω–µ–Ω—Ç Recovery

–ï—Å–ª–∏ –≤—ã –ø—Ä–æ—à–ª–∏ –ú–æ–¥—É–ª—å 2, –≤—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ PostgreSQL connector –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ö–µ–º ‚Äî –≤—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ WAL —Å–æ–±—ã—Ç–∏—è. MySQL —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω–∞—á–µ.

**Schema history topic** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π Kafka —Ç–æ–ø–∏–∫, –≥–¥–µ Debezium MySQL connector —Ö—Ä–∞–Ω–∏—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é DDL-–∏–∑–º–µ–Ω–µ–Ω–∏–π (CREATE TABLE, ALTER TABLE) —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ binlog –ø–æ–∑–∏—Ü–∏—è–º. –≠—Ç–æ –ø–∞–º—è—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞, –±–µ–∑ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –ø–æ–≥—Ä—É–∑–∏–º—Å—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É schema history, —Ä–∞–∑–±–µ—Ä—ë–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ retention, –∏–∑—É—á–∏–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—É—á–∏–º—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —ç—Ç–æ–≥–æ —Ç–æ–ø–∏–∫–∞.

<Callout type="note">
**PostgreSQL vs MySQL:** PostgreSQL –Ω–µ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ schema history topic, –ø–æ—Ç–æ–º—É —á—Ç–æ logical decoding —Å–æ–±—ã—Ç–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü. MySQL binlog —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ TABLE_MAP —Å–æ–±—ã—Ç–∏—è —Å table_id ‚Äî –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å—Ö–µ–º—É.
</Callout>

## –ü–æ—á–µ–º—É MySQL –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ Schema History?

–†–∞–∑–±–µ—Ä—ë–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É PostgreSQL –∏ MySQL CDC.

### PostgreSQL: –°—Ö–µ–º–∞ –≤ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏

```json
// PostgreSQL WAL —Å–æ–±—ã—Ç–∏–µ (—á–µ—Ä–µ–∑ pgoutput)
{
  "schema": {
    "type": "struct",
    "fields": [
      {"field": "id", "type": "int64"},
      {"field": "name", "type": "string"},
      {"field": "email", "type": "string"}
    ]
  },
  "payload": {
    "before": null,
    "after": {"id": 1, "name": "Alice", "email": "alice@example.com"}
  }
}
```

**–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ö–µ–º–µ.** –î–∞–∂–µ –µ—Å–ª–∏ connector –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –æ–Ω –º–æ–∂–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### MySQL: TABLE_MAP —Ç–æ–ª—å–∫–æ —Å table_id

```
// MySQL binlog —Å–æ–±—ã—Ç–∏–µ (ROW —Ñ–æ—Ä–º–∞—Ç)
TABLE_MAP_EVENT:
  table_id: 108
  database: inventory
  table: customers
  (—Å—Ö–µ–º–∞ –ù–ï –≤–∫–ª—é—á–µ–Ω–∞)

WRITE_ROWS_EVENT:
  table_id: 108
  row_data: [1, "Alice", "alice@example.com"]
```

**–ü—Ä–æ–±–ª–µ–º–∞:** WRITE_ROWS_EVENT —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Å—ã—Ä—ã–µ –±–∞–π—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∏ table_id. –ß—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ –±–∞–π—Ç—ã, –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å:
- –°–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ?
- –ö–∞–∫–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö?
- –ö–∞–∫–∏–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫?

**–û—Ç–∫—É–¥–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é?** –ò–∑ schema history topic.

<SchemaHistoryFlowDiagram client:visible />

**–í—ã–≤–æ–¥:** Schema history topic ‚Äî —ç—Ç–æ –ø–∞–º—è—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –æ DDL-–∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö. –ë–µ–∑ –Ω–µ–≥–æ MySQL connector –Ω–µ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Schema History?

–†–∞–∑–±–µ—Ä—ë–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª schema history –æ—Ç initial snapshot –¥–æ recovery.

### –§–∞–∑–∞ 1: Initial Snapshot

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –¥–µ–ª–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å–Ω–∏–º–æ–∫ —Ç–∞–±–ª–∏—Ü –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö DDL –≤ schema history topic.

```sql
-- –¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE TABLE customers (
  id INT PRIMARY KEY,
  name VARCHAR(255),
  email VARCHAR(255)
);

CREATE TABLE orders (
  id INT PRIMARY KEY,
  customer_id INT,
  created_at DATETIME
);
```

**–ß—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ schema history topic:**

```json
// –°–æ–æ–±—â–µ–Ω–∏–µ 1: Database structure
{
  "position": {"file": "mysql-bin.000001", "pos": 154},
  "databaseName": "inventory",
  "ddl": "CREATE DATABASE IF NOT EXISTS `inventory`",
  "timestamp": 1706745600000
}

// –°–æ–æ–±—â–µ–Ω–∏–µ 2: Table structure
{
  "position": {"file": "mysql-bin.000001", "pos": 234},
  "databaseName": "inventory",
  "ddl": "CREATE TABLE `customers` (
    `id` int NOT NULL,
    `name` varchar(255),
    `email` varchar(255),
    PRIMARY KEY (`id`)
  )",
  "timestamp": 1706745601000
}

// –°–æ–æ–±—â–µ–Ω–∏–µ 3: Another table
{
  "position": {"file": "mysql-bin.000001", "pos": 456},
  "databaseName": "inventory",
  "ddl": "CREATE TABLE `orders` (...)",
  "timestamp": 1706745602000
}
```

### –§–∞–∑–∞ 2: Streaming Changes (DDL –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç DDL –æ–ø–µ—Ä–∞—Ü–∏—é, Debezium –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –µ—ë –≤ schema history.

```sql
-- DBA –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é
ALTER TABLE customers ADD COLUMN phone VARCHAR(20);
```

**Debezium –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç DDL –∏–∑ binlog:**

```
QUERY_EVENT:
  database: inventory
  query: ALTER TABLE customers ADD COLUMN phone VARCHAR(20)
  binlog_position: (mysql-bin.000003, 1024)
```

**–ó–∞–ø–∏—Å—å –≤ schema history topic:**

```json
{
  "position": {"file": "mysql-bin.000003", "pos": 1024},
  "databaseName": "inventory",
  "ddl": "ALTER TABLE `customers` ADD COLUMN `phone` varchar(20)",
  "timestamp": 1706755600000
}
```

### –§–∞–∑–∞ 3: Connector Restart (Replay DDL History)

–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ offset.

<SchemaRecoveryPathsDiagram client:visible />

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä —á–∏—Ç–∞–µ—Ç schema history topic **–æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞**, –ø—Ä–∏–º–µ–Ω—è—è DDL –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ binlog offset. –≠—Ç–æ –¥–∞—ë—Ç –µ–º—É —Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ö–µ–º—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.

## Schema History Topic Configuration

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å schema history topic –¥–ª—è production.

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```json
{
  "name": "mysql-inventory-connector",
  "config": {
    "connector.class": "io.debezium.connector.mysql.MySqlConnector",

    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –∏–º—è —Ç–æ–ø–∏–∫–∞ –¥–ª—è schema history
    "schema.history.internal.kafka.topic": "schema-changes.mysql-inventory",

    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: Kafka bootstrap servers
    "schema.history.internal.kafka.bootstrap.servers": "kafka:9092",

    // –û—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è...
    "database.hostname": "mysql",
    "database.port": "3306",
    "database.server.id": "184054",
    "database.server.name": "mysql-server",
    "table.include.list": "inventory.*"
  }
}
```

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ç–æ–ø–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
- –ï—Å–ª–∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ, –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–π schema history topic

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (recovery tuning)

```json
{
  "config": {
    // ... –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...

    // –ü–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (default: 4)
    "schema.history.internal.kafka.recovery.attempts": "10",

    // –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (default: 500ms)
    "schema.history.internal.kafka.recovery.poll.interval.ms": "1000",

    // Timeout –¥–ª—è —á—Ç–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ (default: 3000ms)
    "schema.history.internal.consumer.sasl.login.refresh.timeout.ms": "10000"
  }
}
```

**–ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ï—Å–ª–∏ Kafka cluster –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
- –ï—Å–ª–∏ schema history topic –±–æ–ª—å—à–æ–π –∏ —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ
- –î–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ recovery –≤ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏

<Callout type="tip">
**Naming convention:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å `schema-changes.{connector-name}` –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏. –ü—Ä–∏–º–µ—Ä—ã: `schema-changes.mysql-inventory`, `schema-changes.aurora-production`.
</Callout>

## –ö–†–ò–¢–ò–ß–ù–û: Retention Configuration

–≠—Ç–æ —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤ Debezium MySQL connector –≤ production.

<Callout type="danger">
**7-–¥–Ω–µ–≤–Ω–∞—è –±–æ–º–±–∞ –∑–∞–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è**

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Confluent Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `log.retention.ms=604800000` (7 –¥–Ω–µ–π). –ï—Å–ª–∏ –≤—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏ retention –¥–ª—è schema history topic, —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π —Å—Ç–∞—Ä—ã–µ DDL –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:**
- –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø–µ—Ä–≤—ã–µ 7 –¥–Ω–µ–π
- –ù–∞ 8-–π –¥–µ–Ω—å retention policy —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (deploy, failover, restart)
- **–û–®–ò–ë–ö–ê:** "The db history topic or its content is fully or partially missing"
- –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä –ù–ï –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π resnapshot
</Callout>

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: Infinite Retention

Schema history topic **–í–°–ï–ì–î–ê** –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π retention.

```bash
# –°–æ–∑–¥–∞–π—Ç–µ schema history topic –î–û –¥–µ–ø–ª–æ—è –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-inventory \
  --partitions 1 \
  --replication-factor 3 \
  --config retention.ms=-1 \
  --config retention.bytes=-1

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
kafka-topics --bootstrap-server kafka:9092 \
  --describe \
  --topic schema-changes.mysql-inventory
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**

```
Topic: schema-changes.mysql-inventory
PartitionCount: 1
ReplicationFactor: 3
Configs: retention.ms=-1,retention.bytes=-1
```

### –ï—Å–ª–∏ —Ç–æ–ø–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º retention

```bash
# –ò–∑–º–µ–Ω–∏—Ç—å retention –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ç–æ–ø–∏–∫–µ
kafka-configs --bootstrap-server kafka:9092 \
  --entity-type topics \
  --entity-name schema-changes.mysql-inventory \
  --alter \
  --add-config retention.ms=-1,retention.bytes=-1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
kafka-configs --bootstrap-server kafka:9092 \
  --entity-type topics \
  --entity-name schema-changes.mysql-inventory \
  --describe
```

<Callout type="warning">
–ï—Å–ª–∏ retention —É–∂–µ —É–¥–∞–ª–∏–ª —Å–æ–æ–±—â–µ–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ù–ï –≤–µ—Ä–Ω—ë—Ç –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ. –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è resnapshot.
</Callout>

## Topic Requirements (Anti-Patterns)

Schema history topic –∏–º–µ–µ—Ç —Å—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü–æ—á–µ–º—É | –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –Ω–∞—Ä—É—à–∏—Ç—å |
|------------|----------|--------|---------------------------|
| **Partitions** | `1` (–û–î–ù–ê –ø–∞—Ä—Ç–∏—Ü–∏—è) | DDL —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ | –°—Ö–µ–º–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ ‚Üí corruption |
| **Retention time** | `-1` (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π) | –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä —á–∏—Ç–∞–µ—Ç –í–°–Æ –∏—Å—Ç–æ—Ä–∏—é –æ—Ç –Ω–∞—á–∞–ª–∞ | Recovery fails –ø–æ—Å–ª–µ 7 –¥–Ω–µ–π (default retention) |
| **Retention bytes** | `-1` (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π) | –¢–æ–ø–∏–∫ –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö MB | Topic purge ‚Üí recovery fails |
| **Cleanup policy** | `delete` (–ù–ï compact) | –ù—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è, –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | Compaction —É–¥–∞–ª–∏—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ DDL ‚Üí schema mismatch |
| **Replication factor** | `‚â• 3` (production) | –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Ç–æ–ø–∏–∫–∞ | –ü–æ—Ç–µ—Ä—è broker ‚Üí –ø–æ—Ç–µ—Ä—è –∏—Å—Ç–æ—Ä–∏–∏ ‚Üí resnapshot |

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:**

```bash
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-inventory \
  --partitions 1 \
  --replication-factor 3 \
  --config retention.ms=-1 \
  --config retention.bytes=-1 \
  --config cleanup.policy=delete \
  --config min.insync.replicas=2
```

<Callout type="danger">
**Anti-pattern: Shared Schema History Topic**

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω schema history topic –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤. –ö–∞–∂–¥—ã–π –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–ø–∏–∫.

**–ü–æ—á–µ–º—É:** –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä A –ø—Ä–æ—á–∏—Ç–∞–µ—Ç DDL –æ—Ç –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ B ‚Üí schema mismatch ‚Üí corrupt events.
</Callout>

## –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Schema History Topic?

–†–∞–∑–±–µ—Ä—ë–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ recovery.

### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

–ö–∞–∂–¥–∞—è DDL –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ JSON —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ Avro).

```json
{
  "source": {
    "version": "2.5.0.Final",
    "connector": "mysql",
    "name": "mysql-server",
    "ts_ms": 1706745600000,
    "snapshot": "false",
    "db": "inventory",
    "table": "customers"
  },
  "position": {
    "transaction_id": null,
    "ts_sec": 1706745600,
    "file": "mysql-bin.000003",
    "pos": 1024,
    "gtids": "3E11FA47-71CA-11E1-9E33-C80AA9429562:1-150",
    "server_id": 1
  },
  "databaseName": "inventory",
  "schemaName": null,
  "ddl": "ALTER TABLE `customers` ADD COLUMN `phone` varchar(20) AFTER `email`",
  "tableChanges": [
    {
      "type": "ALTER",
      "id": "\"inventory\".\"customers\"",
      "table": {
        "defaultCharsetName": "utf8mb4",
        "primaryKeyColumnNames": ["id"],
        "columns": [
          {"name": "id", "jdbcType": 4, "typeName": "INT"},
          {"name": "name", "jdbcType": 12, "typeName": "VARCHAR", "length": 255},
          {"name": "email", "jdbcType": 12, "typeName": "VARCHAR", "length": 255},
          {"name": "phone", "jdbcType": 12, "typeName": "VARCHAR", "length": 20}
        ]
      }
    }
  ]
}
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**

1. **`position`**: Binlog –ø–æ–∑–∏—Ü–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–æ—à–ª–æ DDL
   - `file` + `pos` ‚Äî –¥–ª—è file:offset tracking
   - `gtids` ‚Äî –¥–ª—è GTID tracking

2. **`ddl`**: –ü–æ–ª–Ω—ã–π SQL —Ç–µ–∫—Å—Ç DDL –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, debugging)

3. **`tableChanges`**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Debezium –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è row events
   - –°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–æ–∫ (—Ç–∏–ø—ã, –¥–ª–∏–Ω–∞, constraints)

### –ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π

```bash
# –ß–∏—Ç–∞–µ–º schema history topic
kafka-console-consumer --bootstrap-server kafka:9092 \
  --topic schema-changes.mysql-inventory \
  --from-beginning \
  --property print.key=true
```

**–í—ã–≤–æ–¥ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):**

```
null    {"ddl":"CREATE DATABASE `inventory`","position":{"file":"mysql-bin.000001","pos":154}}
null    {"ddl":"CREATE TABLE `customers` (id INT, name VARCHAR(255))","position":{"file":"mysql-bin.000001","pos":234}}
null    {"ddl":"CREATE TABLE `orders` (...)","position":{"file":"mysql-bin.000001","pos":456}}
null    {"ddl":"ALTER TABLE `customers` ADD COLUMN `email` VARCHAR(255)","position":{"file":"mysql-bin.000002","pos":789}}
null    {"ddl":"ALTER TABLE `customers` ADD COLUMN `phone` VARCHAR(20)","position":{"file":"mysql-bin.000003","pos":1024}}
```

**–ü—Ä–∏ restart –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä:**
1. –ß–∏—Ç–∞–µ—Ç –≤—Å–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –Ω–∞—á–∞–ª–∞
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç DDL –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
3. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É: `customers (id, name, email, phone)`
4. –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç —á—Ç–µ–Ω–∏–µ binlog —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ offset

## Recovery Scenarios

–†–∞–∑–±–µ—Ä—ë–º —Ç–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–±–æ–µ–≤ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

### Scenario A: Normal Connector Restart ‚úÖ

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Connector –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (deploy, reschedule, config update)
- Connector —Å—Ç–∞—Ä—Ç—É–µ—Ç –∑–∞–Ω–æ–≤–æ

**–ü—Ä–æ—Ü–µ—Å—Å recovery:**

<SchemaHistoryCorruptionDiagram client:visible />

**–î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:** –ù–∏–∫–∞–∫–∏—Ö. Recovery –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π.

**–í—Ä–µ–º—è recovery:** –°–µ–∫—É–Ω–¥—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ schema history topic)

---

### Scenario B: Schema History Topic Partially Purged ‚ö†Ô∏è

**–°–∏–º–ø—Ç–æ–º:**
```
ERROR: The db history topic 'schema-changes.mysql-inventory' is fully or partially missing.
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- Default Kafka retention (7 –¥–Ω–µ–π) —É–¥–∞–ª–∏–ª —Å—Ç–∞—Ä—ã–µ DDL –∑–∞–ø–∏—Å–∏
- Connector –Ω–µ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É —Å initial snapshot

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å retention settings
kafka-configs --bootstrap-server kafka:9092 \
  --entity-type topics \
  --entity-name schema-changes.mysql-inventory \
  --describe

# –ï—Å–ª–∏ retention.ms != -1, —ç—Ç–æ –ø—Ä–∏—á–∏–Ω–∞
```

**Recovery Option 1: Resnapshot (–ú–ï–î–õ–ï–ù–ù–û)**

<Callout type="warning">
**Resnapshot –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å —á–∞—Å—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü**

–î–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–±–ª–∏—Ü–µ–π –Ω–∞ 100GB, initial snapshot –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è 2-4 —á–∞—Å–∞. –£—á–∏—Ç—ã–≤–∞–π—Ç–µ downtime.
</Callout>

```bash
# 1. –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä
curl -X DELETE http://localhost:8083/connectors/mysql-inventory-connector

# 2. –£–¥–∞–ª–∏—Ç—å schema history topic
kafka-topics --bootstrap-server kafka:9092 \
  --delete \
  --topic schema-changes.mysql-inventory

# 3. –°–æ–∑–¥–∞—Ç—å —Ç–æ–ø–∏–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º retention
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-inventory \
  --partitions 1 \
  --replication-factor 3 \
  --config retention.ms=-1 \
  --config retention.bytes=-1

# 4. –£–¥–∞–ª–∏—Ç—å Kafka Connect offsets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –Ω–∞—á–∞—Ç—å —Å snapshot.mode=initial
kafka-console-consumer --bootstrap-server kafka:9092 \
  --topic connect-offsets \
  --from-beginning \
  --property print.key=true | grep mysql-inventory-connector
# (manually delete offset records via Kafka Connect REST API)

# 5. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —Å snapshot.mode=initial
curl -X POST http://localhost:8083/connectors \
  -H "Content-Type: application/json" \
  -d '{
    "name": "mysql-inventory-connector",
    "config": {
      "snapshot.mode": "initial",
      ...
    }
  }'
```

**Recovery Option 2: Restore from Backup (–ë–´–°–¢–†–û)**

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å backup schema history topic (—Å–º. —Å–µ–∫—Ü–∏—é "Backup Procedures"):

```bash
# 1. –£–¥–∞–ª–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π —Ç–æ–ø–∏–∫
kafka-topics --bootstrap-server kafka:9092 \
  --delete \
  --topic schema-changes.mysql-inventory

# 2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-inventory \
  --partitions 1 \
  --replication-factor 3 \
  --config retention.ms=-1

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
kafka-console-producer --bootstrap-server kafka:9092 \
  --topic schema-changes.mysql-inventory \
  < schema-history-backup-2026-01-31.json

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä
curl -X POST http://localhost:8083/connectors/mysql-inventory-connector/restart
```

**–í—Ä–µ–º—è recovery:** 1-5 –º–∏–Ω—É—Ç (vs —á–∞—Å—ã –¥–ª—è resnapshot)

---

### Scenario C: Schema History Topic Corrupted üí•

**–°–∏–º–ø—Ç–æ–º:**
- Events —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
- Schema parsing errors –≤ –ª–æ–≥–∞—Ö Debezium
- Events —Å –¥–∞–Ω–Ω—ã–º–∏, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ

```
ERROR: Column count doesn't match value count at row 1
ERROR: Unknown column 'old_column_name' in field list
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ schema history topic
- –°–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ DDL
- Kafka broker corruption

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü—Ä–æ—á–∏—Ç–∞—Ç—å schema history topic
kafka-console-consumer --bootstrap-server kafka:9092 \
  --topic schema-changes.mysql-inventory \
  --from-beginning

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞:
# - –ù–µ–ø–æ–ª–Ω—ã–µ JSON —Å–æ–æ–±—â–µ–Ω–∏—è
# - –°–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ binlog positions
# - –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è DDL –æ–ø–µ—Ä–∞—Ü–∏–∏
```

**Recovery (–¢–û–õ–¨–ö–û resnapshot):**

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä
curl -X DELETE http://localhost:8083/connectors/mysql-inventory-connector

# 2. –£–¥–∞–ª–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π schema history topic
kafka-topics --bootstrap-server kafka:9092 \
  --delete \
  --topic schema-changes.mysql-inventory

# 3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-inventory \
  --partitions 1 \
  --replication-factor 3 \
  --config retention.ms=-1 \
  --config retention.bytes=-1

# 4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —Å snapshot.mode=initial
curl -X POST http://localhost:8083/connectors \
  -H "Content-Type: application/json" \
  -d @mysql-connector-config.json
```

---

### Scenario D: Multiple Connectors Sharing Topic üö´

<Callout type="danger">
**Anti-pattern: Shared schema history topic**

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º —Å–±–æ—è–º.
</Callout>

**–°–∏–º–ø—Ç–æ–º:**
- Random schema errors (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, –Ω–µ–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ)
- Connector A –≤–∏–¥–∏—Ç DDL –æ—Ç Connector B
- Events —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ

```
ERROR: Column 'customer_id' doesn't exist in table 'products'
(Connector A –ø—Ä–æ—á–∏—Ç–∞–ª DDL –æ—Ç Connector B, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥—Ä—É–≥–æ–π –±–∞–∑–æ–π)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –î–≤–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∏–º—è schema history topic
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `topic.prefix` –±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ schema history topic

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```json
// Connector A
{
  "name": "mysql-connector-a",
  "config": {
    "schema.history.internal.kafka.topic": "schema-changes.shared"  // ‚ùå WRONG
  }
}

// Connector B
{
  "name": "mysql-connector-b",
  "config": {
    "schema.history.internal.kafka.topic": "schema-changes.shared"  // ‚ùå WRONG
  }
}
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```json
// Connector A
{
  "name": "mysql-connector-a",
  "config": {
    "schema.history.internal.kafka.topic": "schema-changes.mysql-connector-a"  // ‚úÖ UNIQUE
  }
}

// Connector B
{
  "name": "mysql-connector-b",
  "config": {
    "schema.history.internal.kafka.topic": "schema-changes.mysql-connector-b"  // ‚úÖ UNIQUE
  }
}
```

**Recovery:**

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
curl -X DELETE http://localhost:8083/connectors/mysql-connector-a
curl -X DELETE http://localhost:8083/connectors/mysql-connector-b

# 2. –£–¥–∞–ª–∏—Ç—å shared schema history topic
kafka-topics --bootstrap-server kafka:9092 \
  --delete \
  --topic schema-changes.shared

# 3. –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-connector-a \
  --partitions 1 --replication-factor 3 --config retention.ms=-1

kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-connector-b \
  --partitions 1 --replication-factor 3 --config retention.ms=-1

# 4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ snapshot.mode=initial
curl -X POST http://localhost:8083/connectors -d @connector-a-config.json
curl -X POST http://localhost:8083/connectors -d @connector-b-config.json
```

## Monitoring Schema History Health

–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ schema history topic –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã.

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å | –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ | Alert threshold |
|---------|----------------|----------------------|-----------------|
| **Topic size** | –†–∞–∑–º–µ—Ä —Ç–æ–ø–∏–∫–∞ –≤ MB | –†–∞—Å—Ç—ë—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (DDL –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è) | –í–Ω–µ–∑–∞–ø–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –¥–æ 0 |
| **Message count** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ DDL —Å–æ–æ–±—â–µ–Ω–∏–π | –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç (—Ä–µ–¥–∫–∏–µ DDL) | –í–Ω–µ–∑–∞–ø–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ |
| **Consumer lag** | –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä —á–∏—Ç–∞–µ—Ç —Ç–æ–ø–∏–∫ | 0 (–∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —á–∏—Ç–∞–µ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ) | Lag > 0 –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ |
| **Retention config** | `retention.ms` | `-1` (infinite) | –õ—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚â† -1 |

### Kafka Commands –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å retention settings
kafka-configs --bootstrap-server kafka:9092 \
  --entity-type topics \
  --entity-name schema-changes.mysql-inventory \
  --describe | grep retention

# –û–∂–∏–¥–∞–µ—Ç—Å—è: retention.ms=-1, retention.bytes=-1

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–æ–ø–∏–∫–∞
kafka-log-dirs --bootstrap-server kafka:9092 \
  --topic-list schema-changes.mysql-inventory \
  --describe | grep size

# 3. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫–µ
kafka-run-class kafka.tools.GetOffsetShell \
  --bootstrap-server kafka:9092 \
  --topic schema-changes.mysql-inventory | \
  awk -F: '{sum += $3} END {print "Total messages:", sum}'

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–ø–∏–∫ –Ω–µ compacted
kafka-topics --bootstrap-server kafka:9092 \
  --describe \
  --topic schema-changes.mysql-inventory | grep cleanup.policy

# –û–∂–∏–¥–∞–µ—Ç—Å—è: cleanup.policy=delete (NOT compact)
```

### Alerts –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```yaml
# Prometheus AlertManager rule (–ø—Ä–∏–º–µ—Ä)
groups:
  - name: debezium_schema_history
    rules:
      - alert: SchemaHistoryRetentionIncorrect
        expr: |
          kafka_topic_config{topic=~"schema-changes.*",key="retention.ms"} != -1
        for: 5m
        annotations:
          summary: "Schema history topic has finite retention (CRITICAL)"

      - alert: SchemaHistoryTopicSizeDecreased
        expr: |
          delta(kafka_log_size{topic=~"schema-changes.*"}[1h]) < 0
        for: 5m
        annotations:
          summary: "Schema history topic size decreased (possible purge)"

      - alert: SchemaHistoryPartitionCountWrong
        expr: |
          kafka_topic_partitions{topic=~"schema-changes.*"} != 1
        for: 5m
        annotations:
          summary: "Schema history topic has multiple partitions (MISCONFIGURED)"
```

<Callout type="tip">
**Proactive monitoring saves hours of downtime**

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ alert –Ω–∞ `retention.ms != -1` –≤ –ø–µ—Ä–≤—ã–π –∂–µ –¥–µ–Ω—å. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç 7-–¥–Ω–µ–≤–Ω—É—é –±–æ–º–±—É.
</Callout>

## Backup and Restore Procedures

Backup schema history topic –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç recovery.

### –ü–æ—á–µ–º—É backup –∫—Ä–∏—Ç–∏—á–µ–Ω?

**–°—Ü–µ–Ω–∞—Ä–∏–π –±–µ–∑ backup:**
- Schema history topic purged –∏–ª–∏ corrupted
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: full resnapshot
- –î–ª—è 100GB —Ç–∞–±–ª–∏—Ü—ã: 2-4 —á–∞—Å–∞ downtime

**–°—Ü–µ–Ω–∞—Ä–∏–π —Å backup:**
- Restore schema history topic –∏–∑ backup
- Restart –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
- Recovery –∑–∞ 1-5 –º–∏–Ω—É—Ç

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å backup

```bash
# –≠–∫—Å–ø–æ—Ä—Ç schema history topic –≤ —Ñ–∞–π–ª
kafka-console-consumer --bootstrap-server kafka:9092 \
  --topic schema-changes.mysql-inventory \
  --from-beginning \
  --property print.key=true \
  --property print.timestamp=true \
  --timeout-ms 10000 \
  > schema-history-backup-$(date +%Y-%m-%d).json

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ —Ñ–∞–π–ª–∞:
# CreateTime:1706745600000    null    {"ddl":"CREATE TABLE ...","position":{...}}
# CreateTime:1706745601000    null    {"ddl":"ALTER TABLE ...","position":{...}}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —á–∞—Å—Ç–æ—Ç–µ backup:**
- Daily backup –¥–ª—è production –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ DDL –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º)
- Retention: –•—Ä–∞–Ω–∏—Ç–µ backups –º–∏–Ω–∏–º—É–º 30 –¥–Ω–µ–π

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å cron:**

```bash
#!/bin/bash
# /usr/local/bin/backup-schema-history.sh

KAFKA_BROKER="kafka:9092"
TOPIC="schema-changes.mysql-inventory"
BACKUP_DIR="/backups/debezium-schema-history"
DATE=$(date +%Y-%m-%d)

mkdir -p "$BACKUP_DIR"

kafka-console-consumer --bootstrap-server "$KAFKA_BROKER" \
  --topic "$TOPIC" \
  --from-beginning \
  --property print.key=true \
  --timeout-ms 10000 \
  > "$BACKUP_DIR/schema-history-$DATE.json"

# Compress —Å—Ç–∞—Ä—ã—Ö backups (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
gzip "$BACKUP_DIR/schema-history-$DATE.json"

# –£–¥–∞–ª–∏—Ç—å backups —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
find "$BACKUP_DIR" -name "schema-history-*.json.gz" -mtime +30 -delete
```

**Cron schedule (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2 AM):**

```cron
0 2 * * * /usr/local/bin/backup-schema-history.sh
```

### –ö–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π schema history topic (–µ—Å–ª–∏ —É–¥–∞–ª—ë–Ω)
kafka-topics --bootstrap-server kafka:9092 \
  --create \
  --topic schema-changes.mysql-inventory \
  --partitions 1 \
  --replication-factor 3 \
  --config retention.ms=-1 \
  --config retention.bytes=-1

# 2. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å backup (–µ—Å–ª–∏ gzipped)
gunzip schema-history-backup-2026-01-31.json.gz

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫
# –í–ê–ñ–ù–û: –£–¥–∞–ª–∏—Ç–µ timestamps –∏ keys –∏–∑ backup —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ restore
cat schema-history-backup-2026-01-31.json | \
  awk -F'\t' '{print $3}' | \
  kafka-console-producer --bootstrap-server kafka:9092 \
    --topic schema-changes.mysql-inventory

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã
kafka-run-class kafka.tools.GetOffsetShell \
  --bootstrap-server kafka:9092 \
  --topic schema-changes.mysql-inventory

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä
curl -X POST http://localhost:8083/connectors/mysql-inventory-connector/restart
```

<Callout type="warning">
**Restore must use exact same topic name**

Schema history topic name hardcoded –≤ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–µ. –ï—Å–ª–∏ –≤—ã restore –≤ —Ç–æ–ø–∏–∫ —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º, –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥—ë—Ç –∏—Å—Ç–æ—Ä–∏—é.
</Callout>

## Schema Evolution Best Practices

–ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å DDL –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ production CDC –ø–∞–π–ø–ª–∞–π–Ω–µ.

### Compatible Schema Changes (Seamless)

–≠—Ç–∏ DDL –æ–ø–µ—Ä–∞—Ü–∏–∏ –ù–ï –ª–æ–º–∞—é—Ç CDC –ø–∞–π–ø–ª–∞–π–Ω:

```sql
-- ‚úÖ ADD COLUMN (nullable –∏–ª–∏ —Å default)
ALTER TABLE customers ADD COLUMN phone VARCHAR(20);
ALTER TABLE customers ADD COLUMN created_at DATETIME DEFAULT CURRENT_TIMESTAMP;

-- ‚úÖ ADD INDEX (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ CDC)
CREATE INDEX idx_email ON customers(email);

-- ‚úÖ RENAME COLUMN (Debezium –≤–∏–¥–∏—Ç –Ω–æ–≤–æ–µ –∏–º—è)
ALTER TABLE customers RENAME COLUMN name TO full_name;
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. MySQL –≤—ã–ø–æ–ª–Ω—è–µ—Ç DDL
2. Debezium –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç DDL –≤ schema history topic
3. –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—É—é —Å—Ö–µ–º—É
4. Consumers –ø–æ–ª—É—á–∞—é—Ç events —Å –Ω–æ–≤—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏

**No downtime, no coordination needed.**

### Incompatible Schema Changes (Requires Coordination)

–≠—Ç–∏ DDL –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å consumers:

```sql
-- ‚ö†Ô∏è DROP COLUMN
ALTER TABLE customers DROP COLUMN email;

-- ‚ö†Ô∏è CHANGE COLUMN TYPE
ALTER TABLE customers MODIFY COLUMN id BIGINT;

-- ‚ö†Ô∏è RENAME TABLE
RENAME TABLE customers TO users;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Consumers –æ–∂–∏–¥–∞—é—Ç —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É.

**Best practice workflow:**

```
1. Deploy new consumer version (supports both old and new schema)
2. Wait for all consumers to upgrade
3. Execute DDL in MySQL
4. Debezium automatically propagates schema change
5. Old consumer version gracefully handles missing column (if coded defensively)
6. After migration period, deploy final consumer version (only new schema)
```

<Callout type="tip">
**Test schema changes in staging first**

–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ DDL –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ staging environment —Å –ø–æ–ª–Ω—ã–º CDC –ø–∞–π–ø–ª–∞–π–Ω–æ–º. –≠—Ç–æ –≤—ã—è–≤–∏—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–æ production deploy.
</Callout>

### Handling Large DDL Operations

```sql
-- –û–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–∏–Ω—É—Ç—ã/—á–∞—Å—ã
ALTER TABLE large_table ADD COLUMN metadata JSON;
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- MySQL –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –≤—Ä–µ–º—è DDL (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ –∏ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- Debezium –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å timeout –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∞—è
- Binlog position –Ω–µ –¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è DDL

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Online DDL (MySQL 8.0+)**
   ```sql
   ALTER TABLE large_table
     ADD COLUMN metadata JSON,
     ALGORITHM=INPLACE, LOCK=NONE;
   ```

2. **–î–ª—è —Å—Ç–∞—Ä—ã—Ö MySQL –≤–µ—Ä—Å–∏–π: pt-online-schema-change**
   ```bash
   pt-online-schema-change --alter "ADD COLUMN metadata JSON" \
     D=inventory,t=large_table \
     --execute
   ```

3. **Monitor Debezium during DDL**
   - Watch connector status: `curl http://localhost:8083/connectors/mysql-inventory-connector/status`
   - Check for timeout errors in logs

## –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **Schema history topic ‚Äî —ç—Ç–æ –ø–∞–º—è—Ç—å MySQL CDC –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞** ‚Äî –±–µ–∑ –Ω–µ–≥–æ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω recovery –ø–æ—Å–ª–µ restart
2. **PostgreSQL –Ω–µ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ schema history** ‚Äî WAL —Å–æ–±—ã—Ç–∏—è self-contained, MySQL binlog —Ç—Ä–µ–±—É–µ—Ç TABLE_MAP reconstruction
3. **Retention MUST be infinite** ‚Äî `retention.ms=-1` –∏ `retention.bytes=-1` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –∏–Ω–∞—á–µ 7-–¥–Ω–µ–≤–Ω–∞—è –±–æ–º–±–∞
4. **Single partition required** ‚Äî DDL —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ
5. **Unique topic per connector** ‚Äî sharing schema history topic –º–µ–∂–¥—É –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞–º–∏ –≤–µ–¥—ë—Ç –∫ corruption
6. **Backup schema history topic** ‚Äî restore –∑–∞ –º–∏–Ω—É—Ç—ã vs resnapshot –∑–∞ —á–∞—Å—ã
7. **Monitor retention config** ‚Äî alert –Ω–∞ `retention.ms != -1` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã
8. **Compatible DDL seamless** ‚Äî ADD COLUMN, ADD INDEX –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ propagate
9. **Incompatible DDL requires coordination** ‚Äî DROP COLUMN, RENAME TABLE –Ω—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å consumers
10. **Test DDL changes in staging** ‚Äî –ø–æ–ª–Ω—ã–π CDC –ø–∞–π–ø–ª–∞–π–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –¥–æ production
11. **Never manually edit schema history topic** ‚Äî corruption –≤–µ–¥—ë—Ç –∫ mandatory resnapshot
12. **Schema history NOT compacted** ‚Äî `cleanup.policy=delete`, –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Ä–æ–ª—å schema history topic –¥–ª—è MySQL CDC recovery. –¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å retention, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏–∑ backup –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Ç–æ–ø–∏–∫–∞.

–í —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–∫–∞—Ö –ú–æ–¥—É–ª—è 8 –º—ã –ø–µ—Ä–µ–π–¥—ë–º –∫ AWS Aurora MySQL ‚Äî managed service —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ CDC:
- –ü–∞—Ä–∞–º–µ—Ç—Ä-–≥—Ä—É–ø–ø—ã Aurora –¥–ª—è binlog –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –≤ RDS/Aurora
- Read replica –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è CDC
- Aurora-specific monitoring –∏ troubleshooting

Aurora MySQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã schema history, –Ω–æ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è managed services. Prepare to dive deep.
